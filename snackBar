<template>
  <v-container>
    <v-form ref="form" v-model="valid" lazy-validation>
      <div v-for="field in loginData" :key="field.data.saveAs">
        <common-text-input
          :item="field"
          @addValue="updateFieldValue(field.data.saveAs, $event)"
        ></common-text-input>
      </div>

      <v-btn :disabled="!valid" color="primary" @click="login">Login</v-btn>
    </v-form>

    <!-- Snackbar for Login Result -->
    <v-snackbar v-model="snackbar" :color="snackbarColor" timeout="3000">
      {{ snackbarMessage }}
      <template v-slot:action="{ attrs }">
        <v-btn text v-bind="attrs" @click="snackbar = false">Close</v-btn>
      </template>
    </v-snackbar>

    <!-- Display Entered Credentials -->
    <div v-if="loginSuccess" class="entered-credentials">
      <h3>Entered Credentials:</h3>
      <p><strong>Username:</strong> {{ username }}</p>
      <p><strong>Password:</strong> {{ password }}</p>
    </div>
  </v-container>
</template>

<script>
  import CommonTextInput from './CommonTextInput.vue' // Adjust the path as necessary
  import { LOGIN_DATA } from './loginFields.js' // Adjust the path as necessary

  export default {
    components: {
      CommonTextInput,
    },
    data() {
      return {
        valid: false,
        loginSuccess: false,
        loginFailed: false,
        snackbar: false,
        snackbarMessage: '',
        snackbarColor: '',
        credentials: {
          username: '',
          password: '',
        },
        loginData: LOGIN_DATA,
        mockCredentials: {
          username: 'testUser',
          password: 'testPassword',
        },
      }
    },
    computed: {
      username() {
        return this.credentials.username
      },
      password() {
        return this.credentials.password
      },
    },
    methods: {
      updateFieldValue(fieldName, data) {
        this.credentials[fieldName] = data.value // Update the credentials object
      },
      login() {
        if (this.$refs.form.validate()) {
          const isValidLogin =
            this.credentials.username === this.mockCredentials.username &&
            this.credentials.password === this.mockCredentials.password

          this.loginSuccess = isValidLogin // Show success alert
          this.loginFailed = !isValidLogin // Show failure alert

          if (isValidLogin) {
            this.snackbarMessage = `Login successful! Welcome, ${this.username}.`
            this.snackbarColor = 'success'
            console.log('Logging in with:', this.username, this.password)
          } else {
            this.snackbarMessage =
              'Invalid username or password. Please try again.'
            this.snackbarColor = 'error'
          }

          this.snackbar = true // Show snackbar
        }
      },
    },
  }
</script>

<style scoped>
  .entered-credentials {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
  }
</style>
